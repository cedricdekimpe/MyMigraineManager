<% content_for :title, "Migraine log" %>

<section class="flex flex-col gap-6">
  <header class="flex flex-col gap-4 rounded-xl border border-slate-200 bg-white p-6 shadow-sm sm:flex-row sm:items-center sm:justify-between">
    <div>
      <p class="text-sm font-medium text-slate-500">Current month</p>
      <h1 class="text-2xl font-semibold text-slate-900"><%= @current_month.strftime("%B %Y") %></h1>
    </div>
    <div class="flex flex-wrap items-center gap-3 text-sm">
      <%= link_to "Previous", migraines_path(month: @previous_month.strftime("%Y-%m")), class: "rounded-md border border-slate-300 bg-white px-3 py-1.5 font-medium text-slate-700 transition hover:border-slate-400" %>
      <%= link_to "Next", migraines_path(month: @next_month.strftime("%Y-%m")), class: "rounded-md border border-slate-300 bg-white px-3 py-1.5 font-medium text-slate-700 transition hover:border-slate-400" %>
      <%= link_to "New entry", new_migraine_path, class: "rounded-md bg-emerald-600 px-3 py-1.5 font-semibold text-white transition hover:bg-emerald-700" %>
    </div>
  </header>

  <div class="overflow-x-auto rounded-xl border border-slate-200 bg-white shadow-sm">
    <table class="min-w-full table-fixed">
      <thead>
        <tr>
          <th class="sticky left-0 bg-white px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-500">Attribute</th>
          <% @days.each do |day| %>
            <th class="px-3 py-3 text-center text-xs font-semibold uppercase tracking-wide text-slate-500"><%= day %></th>
          <% end %>
        </tr>
      </thead>
      <tbody class="text-sm">
        <tr>
          <th scope="row" class="sticky left-0 bg-white px-4 py-3 text-left font-medium text-slate-700">Nature</th>
          <% @days.each do |day| %>
            <% migraine = @migraines_by_day[day] %>
            <td class="<%= migraine_cell_classes(day, @current_month) %>" data-day="<%= day %>" data-attribute="nature"><%= migraine&.nature || "–" %></td>
          <% end %>
        </tr>
        <tr>
          <th scope="row" class="sticky left-0 bg-white px-4 py-3 text-left font-medium text-slate-700">Intensity</th>
          <% @days.each do |day| %>
            <% migraine = @migraines_by_day[day] %>
            <td class="<%= migraine_cell_classes(day, @current_month) %>" data-day="<%= day %>" data-attribute="intensity"><%= migraine&.intensity || "–" %></td>
          <% end %>
        </tr>
        <tr>
          <th scope="row" class="sticky left-0 bg-white px-4 py-3 text-left font-medium text-slate-700">Menstrual cycle</th>
          <% @days.each do |day| %>
            <% migraine = @migraines_by_day[day] %>
            <td class="<%= migraine_cell_classes(day, @current_month) %>" data-day="<%= day %>" data-attribute="cycle"><%= migraine.nil? ? "–" : (migraine.on_period? ? "Yes" : "No") %></td>
          <% end %>
        </tr>
        <tr>
          <th scope="row" class="sticky left-0 bg-white px-4 py-3 text-left font-medium text-slate-700">Medication</th>
          <% @days.each do |day| %>
            <% migraine = @migraines_by_day[day] %>
            <td class="<%= migraine_cell_classes(day, @current_month) %>" data-day="<%= day %>" data-attribute="medication"><%= migraine&.medication.presence || "–" %></td>
          <% end %>
        </tr>
      </tbody>
    </table>
  </div>
</section>
